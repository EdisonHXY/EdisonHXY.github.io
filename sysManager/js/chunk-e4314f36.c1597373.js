(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e4314f36"],{"1b92":function(t,e,a){"use strict";a("f78b")},5269:function(t,e,a){"use strict";a("f20b")},"748a":function(t,e,a){"use strict";a("e2f8")},9231:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:5}},[a("div",{staticClass:"fullHeight borderDes"},[a("el-tree",{ref:"tree",attrs:{"highlight-current":!0,data:t.treeData,props:t.props,load:t.loadNode,lazy:"","node-key":"id","expand-on-click-node":!1},on:{"node-contextmenu":t.rightClick,"node-click":t.clickFunc},scopedSlots:t._u([{key:"default",fn:function(e){e.node;var i=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{staticClass:"iconSpan",class:i.icon}),t._v(t._s(i.name)+" ")])])}}])})],1)]),a("el-col",{attrs:{span:19}},[a("div",{staticClass:"fullHeight"},[t.sideShow_allLine?a("allLineVue"):t.sideShow_station?a("stationinfoVue",{attrs:{code:t.trsfData.id,isStation:t.trsfType,isAdd:t.isAdd},on:{add:t.addStaAction,change:t.changeStationName}}):t.sideShow_line?a("lineInfoVue",{attrs:{code:t.trsfData.id,isAdd:t.isAdd},on:{change:t.changeLineName,add:t.addLinAction}}):t._e()],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.menuVisible,expression:"menuVisible"}],staticClass:"menu",attrs:{id:"menu"}},[a("div",{staticClass:"menu__item"},[a("el-button",{attrs:{type:"success",icon:"el-icon-plus",size:"mini",disabled:!t.showAddLine},on:{click:t.addLine}},[t._v("新增线路")])],1),a("div",{staticClass:"menu__item"},[a("el-button",{attrs:{type:"success",icon:"el-icon-delete",size:"mini",disabled:!t.showDeleteLine},on:{click:t.deleteLinAction}},[t._v("删除线路")])],1),a("div",{staticClass:"menu__item"},[a("el-button",{attrs:{type:"warning",icon:"el-icon-plus",size:"mini",disabled:!t.showAddStation},on:{click:function(e){return t.addStation(!0)}}},[t._v("新增车站")])],1),a("div",{staticClass:"menu__item"},[a("el-button",{attrs:{type:"warning",icon:"el-icon-delete",size:"mini",disabled:!t.showDeleteStation},on:{click:t.deleteStation}},[t._v("删除车站")])],1),a("div",{staticClass:"menu__item"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini",disabled:!t.showAddTrain},on:{click:function(e){return t.addStation(!1)}}},[t._v("新增列车")])],1),a("div",{staticClass:"menu__item",staticStyle:{"margin-bottom":"5px"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-delete",size:"mini",disabled:!t.showDeleteTrain},on:{click:t.deleteStation}},[t._v("删除列车")])],1)]),a("el-dialog",{attrs:{center:"",title:"提示",visible:t.dialog.visible,width:"20%"},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[a("span",[t._v(t._s(t.dialog.tipMsg))]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialog.visible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.dialogOkClick}},[t._v("确 定")])],1)])],1)],1)},n=[],s=(a("b0c0"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{"margin-right":"20px","margin-left":"20px"}},[a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{"highlight-current-row":"",border:"",data:t.tableData_type,"max-height":"500px"}},[a("el-table-column",{attrs:{label:"线路编号",prop:"id"}}),a("el-table-column",{attrs:{label:"线路名称",prop:"name"}}),a("el-table-column",{attrs:{label:"英文名称",prop:"enName"}}),a("el-table-column",{attrs:{label:"数据服务器",prop:"dataServer"}}),a("el-table-column",{attrs:{label:"命令服务器",prop:"cmdServer"}}),a("el-table-column",{attrs:{label:"支线路数",prop:"subLineNum"}})],1)],1)])])}),o=[],l={name:"allLineVue",data:function(){return{tableData_type:[]}},mounted:function(){console.log("获取全部线路信息");var t=this;this.$httpApi.lineInfo("0").then((function(e){"0"==e.data.code&&(console.log(JSON.stringify(e.data.dataList)),t.tableData_type=e.data.dataList)}))}},r=l,d=(a("d32e"),a("2877")),c=Object(d["a"])(r,s,o,!1,null,null,null),u=c.exports,p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{"margin-right":"10px","margin-left":"10px"}},[a("div",{staticClass:"boderDes"},[a("h4",{staticStyle:{"margin-left":"20px"}},[t._v(t._s(t.title))]),a("el-form",{ref:"data",attrs:{inline:!0,disabled:t.formDisable,model:t.data,"label-width":"90px"}},[a("el-form-item",{attrs:{label:t.formTip.id,prop:"id"}},[a("el-input",{attrs:{disabled:t.idDisable},model:{value:t.data.id,callback:function(e){t.$set(t.data,"id",e)},expression:"data.id"}})],1),a("el-form-item",{attrs:{label:t.formTip.name,prop:"name"}},[a("el-input",{model:{value:t.data.name,callback:function(e){t.$set(t.data,"name",e)},expression:"data.name"}})],1),a("el-form-item",{attrs:{label:"启运时间",prop:"startTime"}},[a("el-input",{model:{value:t.data.startTime,callback:function(e){t.$set(t.data,"startTime",e)},expression:"data.startTime"}})],1),a("el-form-item",{attrs:{label:"停运时间",prop:"stopTime"}},[a("el-input",{model:{value:t.data.stopTime,callback:function(e){t.$set(t.data,"stopTime",e)},expression:"data.stopTime"}})],1),a("el-form-item",{attrs:{label:"英文名称",prop:"enName"}},[a("el-input",{model:{value:t.data.enName,callback:function(e){t.$set(t.data,"enName",e)},expression:"data.enName"}})],1),a("el-form-item",{attrs:{label:t.formTip.ip,prop:"dataServer"}},[a("el-input",{model:{value:t.data.dataServer,callback:function(e){t.$set(t.data,"dataServer",e)},expression:"data.dataServer"}})],1),a("el-form-item",{attrs:{label:"命令服务器",prop:"cmdServer"}},[a("el-input",{model:{value:t.data.cmdServer,callback:function(e){t.$set(t.data,"cmdServer",e)},expression:"data.cmdServer"}})],1),a("el-form-item",{attrs:{label:"车站ATS",prop:"stationAts"}},[a("el-input",{model:{value:t.data.stationAts,callback:function(e){t.$set(t.data,"stationAts",e)},expression:"data.stationAts"}})],1),a("el-form-item",{attrs:{label:"列车ATS",prop:"trainAts"}},[a("el-input",{model:{value:t.data.trainAts,callback:function(e){t.$set(t.data,"trainAts",e)},expression:"data.trainAts"}})],1),a("el-form-item",{attrs:{label:t.formTip.des,prop:"des"}},[a("el-input",{model:{value:t.data.des,callback:function(e){t.$set(t.data,"des",e)},expression:"data.des"}})],1),a("el-form-item",{attrs:{label:"是否OCC",formatter:t.formatOcc}},[a("el-checkbox",{model:{value:t.data.center,callback:function(e){t.$set(t.data,"center",t._n(e))},expression:"data.center"}})],1)],1)],1),a("btnGroupVue",{attrs:{isAdd:t.btnIsAdd,showAddBtn:!0,okState:t.okSta},on:{editAction:t.editClick,cancelAction:t.cancelClick,okAction:t.okClick,addAction:t.addClick,deleteAction:t.deleteClick}}),t.showAddDlg?a("addDev",{attrs:{stationCode:t.addDevData},on:{addFinshed:t.devAdded}}):t._e(),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-table",{ref:"tableRef",staticStyle:{width:"100%"},attrs:{"highlight-current-row":"",border:"",data:t.tableData,"max-height":"500px","cell-style":{textAlign:"center"}},on:{"current-change":t.handleCurrentChange}},[a("el-table-column",{attrs:{label:"设备编号",prop:"id",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-input",{staticClass:"inputNoBorder",model:{value:e.row.id,callback:function(a){t.$set(e.row,"id",a)},expression:"scope.row.id"}}):a("span",[t._v(t._s(e.row.id))])]}}])}),a("el-table-column",{attrs:{label:"名称",prop:"name",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-input",{staticClass:"inputNoBorder",model:{value:e.row.name,callback:function(a){t.$set(e.row,"name",a)},expression:"scope.row.name"}}):a("span",[t._v(t._s(e.row.name))])]}}])}),a("el-table-column",{attrs:{label:"IP地址",prop:"ip",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-input",{staticClass:"inputNoBorder",model:{value:e.row.ip,callback:function(a){t.$set(e.row,"ip",a)},expression:"scope.row.ip"}}):a("span",[t._v(t._s(e.row.ip))])]}}])}),a("el-table-column",{attrs:{label:"物理地址",prop:"mac",align:"center",width:"190"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-input",{staticClass:"inputNoBorder",model:{value:e.row.mac,callback:function(a){t.$set(e.row,"mac",a)},expression:"scope.row.mac"}}):a("span",[t._v(t._s(e.row.mac))])]}}])}),a("el-table-column",{attrs:{label:"类型",prop:"type",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.row.type,callback:function(a){t.$set(e.row,"type",a)},expression:"scope.row.type"}},t._l(t.typdeList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.name}})})),1):a("span",[t._v(t._s(e.row.type))])]}}])}),a("el-table-column",{attrs:{label:"播放区域",prop:"pos",width:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.row.pos,callback:function(a){t.$set(e.row,"pos",a)},expression:"scope.row.pos"}},t._l(t.zonlist,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.name}})})),1):a("span",[t._v(t._s(e.row.pos))])]}}])}),a("el-table-column",{attrs:{label:"回传",prop:"transfer",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-input",{staticClass:"inputNoBorder",model:{value:e.row.transfer,callback:function(a){t.$set(e.row,"transfer",a)},expression:"scope.row.transfer"}}):a("span",[t._v(t._s(e.row.transfer))])]}}])}),a("el-table-column",{attrs:{label:"编码号",prop:"encoder",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-input",{staticClass:"inputNoBorder",model:{value:e.row.encoder,callback:function(a){t.$set(e.row,"encoder",a)},expression:"scope.row.encoder"}}):a("span",[t._v(t._s(e.row.encoder))])]}}])}),a("el-table-column",{attrs:{label:"输入号",prop:"input",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-input",{staticClass:"inputNoBorder",model:{value:e.row.input,callback:function(a){t.$set(e.row,"input",a)},expression:"scope.row.input"}}):a("span",[t._v(t._s(e.row.input))])]}}])}),a("el-table-column",{attrs:{label:"描述",prop:"des",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?a("el-input",{staticClass:"inputNoBorder",attrs:{type:"textarea",autosize:""},model:{value:e.row.des,callback:function(a){t.$set(e.row,"des",a)},expression:"scope.row.des"}}):a("span",[t._v(t._s(e.row.des))])]}}])})],1)],1)],1)])},f=[],h=a("1da1"),m=(a("96cf"),a("159b"),a("a434"),a("5c96")),b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",disabled:t.btnStatue.edit},on:{click:function(e){return t.editClick()}}},[t._v(" 编 辑 ")]),t.showAddBtn?a("el-button",{attrs:{type:"success",icon:"el-icon-plus",disabled:t.btnStatue.add},on:{click:t.addClick}},[t._v(" 添加设备 ")]):t._e(),t.showAddBtn?a("el-button",{attrs:{type:"warning",icon:"el-icon-delete",disabled:t.btnStatue.delete},on:{click:t.deleteClick}},[t._v(" 删除设备 ")]):t._e(),a("el-button",{attrs:{disabled:t.btnStatue.cancel},on:{click:function(e){return t.cancelClick()}}},[t._v(" 取消 ")]),a("el-button",{attrs:{type:"primary",disabled:t.btnStatue.ok},on:{click:function(e){return t.okClick()}}},[t._v(" 确认 ")])],1)},g=[],S={props:{showAddBtn:Boolean,okState:Boolean,isAdd:Boolean},watch:{okState:function(t){console.log("btn",t),this.btnStatue.ok=t},isAdd:function(t){console.log("btn "+t),this.btnStatue.cancel=!t,this.btnStatue.edit=t,this.btnStatue.add=this.btnStatue.delete=!t}},data:function(){return{btnStatue:{edit:!1,add:!0,delete:!0,cancel:!0,ok:!0}}},methods:{addClick:function(){this.$emit("addAction")},deleteClick:function(){this.$emit("deleteAction")},editClick:function(){var t=this;this.$emit("editAction",(function(){t.btnStatue.cancel=!1,t.btnStatue.edit=!0,t.btnStatue.add=t.btnStatue.delete=!1}))},cancelClick:function(){var t=this;this.$emit("cancelAction",(function(){t.btnStatue.cancel=!0,t.btnStatue.ok=!0,t.btnStatue.edit=!1,t.btnStatue.add=t.btnStatue.delete=!0}))},okClick:function(){var t=this;this.$emit("okAction",(function(){t.btnStatue.cancel=!0,t.btnStatue.ok=!0,t.btnStatue.edit=!1,t.btnStatue.add=t.btnStatue.delete=!0}))}}},v=S,D=Object(d["a"])(v,b,g,!1,null,null,null),y=D.exports,k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:t.formData.tipMsg,visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{attrs:{model:t.formData}},[a("el-form-item",{attrs:{label:"活动名称","label-width":"120px"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("确 定")])],1)],1)],1)},w=[],N={props:{stationCode:{}},watch:{stationCode:{handler:function(){this.upData()},deep:!0}},methods:{upData:function(){this.dialogFormVisible=!0,this.formData.tipMsg="S",this.formData.stationCode=this.stationCode.id,this.formData.devCode="",this.formData.devName="",this.formData.devIp="",this.formData.devMac="00-00-00-00-00-00",this.formData.devType="",this.formData.devZone="",this.formData.devBackTrs="",this.formData.devEncoderNum="",this.formData.devInputNum="",this.formData.devDes=""}},data:function(){return{formData:{},dialogFormVisible:!1}}},_=N,A=Object(d["a"])(_,k,w,!1,null,null,null),O=A.exports,C={components:{btnGroupVue:y,addDev:O},props:{code:String,isStation:Boolean,isAdd:Boolean},data:function(){return{btnIsAdd:!1,formDisable:!0,data:{},tableData:[],formTip:{},currentFormData:{},currentTableData:[],okSta:!1,isOcc:!1,title:"车站信息",idDisable:!0,addDevData:{},showAddDlg:!1,currentRow:{},zonlist:[],typdeList:[]}},watch:{data:{handler:function(t){this.okSta=this.dataIsEqual(t,this.currentFormData,!1),console.log("表单变化",this.okSta)},deep:!0},tableData:{handler:function(t){this.okSta=this.dataIsEqual(t,this.currentTableData,!0),console.log("列表变化",this.okSta)},deep:!0},isAdd:function(){this.updateData()},code:function(){this.updateData()},isStation:function(){this.updateData()},formDisable:function(t){t&&this.tableData.forEach((function(t){t.isEdit=!1}))}},methods:{dataIsEqual:function(t,e,a){var i,n;if(a){var s=void 0==e?[]:JSON.parse(JSON.stringify(e)),o=void 0==t?[]:JSON.parse(JSON.stringify(t));void 0!=e&&s.forEach((function(t){delete t.isEdit})),void 0!=t&&o.forEach((function(t){delete t.isEdit})),i=JSON.stringify(s),n=JSON.stringify(o)}else i=JSON.stringify(e),n=JSON.stringify(t);return i===n},formatOcc:function(t,e,a){var i="";return this.isOcc=!!a,i},editClick:function(t){this.formDisable=!1,this.currentRow&&(this.currentRow.isEdit=!0),t()},cancelClick:function(t){this.formDisable=!0,this.data=JSON.parse(JSON.stringify(this.currentFormData)),this.tableData=JSON.parse(JSON.stringify(this.currentTableData)),t()},addClick:function(){var t={id:this.data.id+"-",mac:"00-00-00-00-00-00"};void 0==this.tableData&&(this.tableData=new Array),this.tableData.push(t)},handleCurrentChange:function(t){console.log("选中 ",JSON.stringify(t)),this.currentRow=t,this.formDisable?this.tableData.forEach((function(t){t.isEdit=!1})):t&&this.tableData.forEach((function(e){e.id==t.id?e.isEdit=!0:e.isEdit=!1}))},deleteClick:function(){var t=this;void 0!=this.currentRow.id?this.tableData.forEach((function(e,a){e.id!=t.currentRow.id||t.tableData.splice(a,1)})):m["Message"].error("未选中任何行数据")},addStationOk:function(){var t=this;console.log("添加站点"),t.data.isTrain=!this.isStation,t.data.Line_Code=this.code,this.$httpApi.addStation(t.data).then((function(e){if("0"==e.data.code)return t.okSta=!0,t.currentFormData=JSON.parse(JSON.stringify(t.data)),t.formDisable=!0,t.$emit("add",t.data.id,t.data.name,!t.isStation),!0;m["Message"].error(e.data.message)}));for(var e=0;e<this.tableData.length;e++){var a=this.tableData[e],i=JSON.parse(JSON.stringify(a));i.station_code=t.data.id,i.line_code=t.code,t.typdeList.forEach((function(t){i.type==t.name&&(i.type=t.id)})),console.log("增加",JSON.stringify(i)),this.$httpApi.addDev(i).then((function(t){"0"==t.data.code?console.log("增加成功",i.id):m["Message"].error(t.data.message)}))}return!1},okClick:function(t){var e=this,a=this;if(console.log(JSON.stringify(this.data)),this.isAdd){var i=this.addStationOk();i&&t()}else{if(this.dataIsEqual(this.data,this.currentFormData)||(console.log("更新站点信息"),this.$httpApi.updateStationInfo(this.code,a.data).then((function(t){"0"==t.data.code?(a.currentFormData=JSON.parse(JSON.stringify(a.data)),a.$emit("change",a.data.id,a.data.name)):a.data=JSON.parse(JSON.stringify(a.currentFormData))}))),void 0==this.currentTableData&&(console.log("new curr table"),this.currentTableData=new Array),this.tableData.length>this.currentTableData.length)for(var n=0;n<this.tableData.length;n++){for(var s=this.tableData[n],o=!1,l=0;l<this.currentTableData.length;l++){var r=this.currentTableData[l];if(s.id==r.id){o=!0;break}}if(!o){var d=JSON.parse(JSON.stringify(s));d.station_code=this.data.id,d.line_code=this.data.lineCode,a.typdeList.forEach((function(t){d.type==t.name&&(d.type=t.id)})),console.log("增加",JSON.stringify(d)),this.$httpApi.addDev(d).then((function(t){"0"==t.data.code?console.log("增加成功",d.id):m["Message"].error(t.data.message)}))}}else for(var c=function(t){var i=e.currentTableData[t];p=!1;for(var n=0;n<e.tableData.length;n++){var s=e.tableData[n];if(i.id==s.id){console.log("zaaa"),p=!0,f=JSON.parse(JSON.stringify(i)),h=JSON.parse(JSON.stringify(s)),delete h.isEdit,delete f.isEdit,JSON.stringify(f)!=JSON.stringify(h)&&function(){var t=JSON.parse(JSON.stringify(h));t.station_code=e.data.id,t.line_code=e.data.lineCode,a.typdeList.forEach((function(e){t.type==e.name&&(t.type=e.id)})),console.log("更改",JSON.stringify(t)),e.$httpApi.upDataDev(t).then((function(e){"0"==e.data.code?console.log("更改成功",t.id):m["Message"].error(e.data.message)}))}();break}}p||(console.log("删除",i.id),e.$httpApi.deleteDev(i.id).then((function(t){"0"==t.data.code?console.log("删除成功",i.id):m["Message"].error(t.data.message)})))},u=0;u<this.currentTableData.length;u++){var p,f,h;c(u)}a.currentTableData=JSON.parse(JSON.stringify(a.tableData)),this.formDisable=!0,a.okSta=!0,this.currentFormData=JSON.parse(JSON.stringify(this.data)),t()}},initAddSta:function(){this.btnIsAdd=!0,this.title=this.isStation?"增加车站信息":"增加列车信息",this.formDisable=!1,this.idDisable=!1,this.data={center:!1,cmdServer:"",dataServer:"",des:"",enName:"",id:this.isStation?"S":"T",name:"",startTime:"00:00:00",stationAts:"",stopTime:"00:00:00",trainAts:""},this.currentFormData=JSON.parse(JSON.stringify(this.data)),this.tableData=[],this.currentTableData=[],console.log("添加")},updateData:function(){if(console.log("获取车站信息"+this.code),this.formTip.id=this.isStation?"车站编号":"列车编号",this.formTip.name=this.isStation?"车站名称":"列车名称",this.formTip.des=this.isStation?"车站描述":"列车描述",this.formTip.ip=this.isStation?"服务器IP":"直播服务",this.isAdd)this.initAddSta();else{var t=this;this.btnIsAdd=!1,this.title=this.isStation?"车站信息":"列车信息",this.idDisable=!0,this.$httpApi.stationInfo(this.code).then((function(e){"0"==e.data.code&&(console.log(JSON.stringify(e.data)),t.data=e.data.info,t.tableData=e.data.devList,void 0!=t.tableData?(t.tableData.forEach((function(e){e.isEdit=!1,t.typdeList.forEach((function(t){t.id==e.type&&(e.type=t.name)}))})),t.currentTableData=JSON.parse(JSON.stringify(t.tableData))):t.currentTableData=null,t.currentFormData=JSON.parse(JSON.stringify(t.data)))}))}}},mounted:function(){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,console.log("获取zoneAndtyoe"),e.next=4,t.$httpApi.zoneList_get_sync().then((function(t){"0"==t.data.code&&(a.zonlist=t.data.zoneList,console.log("zone success"))}));case 4:return e.next=6,t.$httpApi.typdeList_sync().then((function(t){"0"==t.data.code&&(a.typdeList=t.data.dataList,console.log("type success"))}));case 6:console.log("请求完成"),t.updateData();case 8:case"end":return e.stop()}}),e)})))()}},$=C,J=(a("5269"),Object(d["a"])($,p,f,!1,null,"42a5c13a",null)),x=J.exports,L=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{"margin-right":"10px","margin-left":"10px"}},[a("div",{staticClass:"boderDes"},[a("h4",{staticStyle:{"margin-left":"20px"}},[t._v(t._s(t.title))]),a("el-form",{ref:"data",attrs:{inline:!0,disabled:t.formDisable,model:t.data,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"线路编号",prop:"id"}},[a("el-input",{attrs:{disabled:t.idDisable},model:{value:t.data.id,callback:function(e){t.$set(t.data,"id",e)},expression:"data.id"}})],1),a("el-form-item",{attrs:{label:"线路名称",prop:"name"}},[a("el-input",{model:{value:t.data.name,callback:function(e){t.$set(t.data,"name",e)},expression:"data.name"}})],1),a("el-form-item",{attrs:{label:"英文名称",prop:"enName"}},[a("el-input",{model:{value:t.data.enName,callback:function(e){t.$set(t.data,"enName",e)},expression:"data.enName"}})],1),a("el-form-item",{attrs:{label:"线路数",prop:"subLineNum"}},[a("el-input",{model:{value:t.data.subLineNum,callback:function(e){t.$set(t.data,"subLineNum",e)},expression:"data.subLineNum"}})],1),a("el-form-item",{attrs:{label:"数据服务器",prop:"dataServer"}},[a("el-input",{model:{value:t.data.dataServer,callback:function(e){t.$set(t.data,"dataServer",e)},expression:"data.dataServer"}})],1),a("el-form-item",{attrs:{label:"命令服务器",prop:"cmdServer"}},[a("el-input",{model:{value:t.data.cmdServer,callback:function(e){t.$set(t.data,"cmdServer",e)},expression:"data.cmdServer"}})],1)],1)],1),a("btn-group",{attrs:{showAddBtn:!1,okState:t.okSta,isAdd:t.btnIsAdd},on:{editAction:t.editClick,cancelAction:t.cancelClick,okAction:t.okClick}}),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{"highlight-current-row":"",border:"",data:t.tableData,disabled:t.formDisable,"max-height":"500px"},on:{"cell-dblclick":t.tableDbEdit}},[a("el-table-column",{attrs:{label:"编号",prop:"id",width:"100"}}),a("el-table-column",{attrs:{label:"名称",prop:"name"}}),a("el-table-column",{attrs:{label:"英文名称",prop:"enName"}}),a("el-table-column",{attrs:{label:"开始时间",prop:"startTime"}}),a("el-table-column",{attrs:{label:"停运时间",prop:"stopTime"}}),a("el-table-column",{attrs:{label:"数据服务器",prop:"dataServer"}}),a("el-table-column",{attrs:{label:"命令服务器",prop:"cmdServer"}}),a("el-table-column",{attrs:{label:"车站ATS",prop:"stationAts"}}),a("el-table-column",{attrs:{label:"列车ATS",prop:"trainAts"}}),a("el-table-column",{attrs:{label:"描述",prop:"des"}})],1)],1)],1)])},T=[],E={components:{btnGroup:y},props:{code:String,isStation:Boolean,isAdd:Boolean},data:function(){return{title:"线路信息",btnIsAdd:!1,formDisable:!0,data:{},tableData:[],currentFormData:{},okSta:!1,idDisable:!0}},watch:{data:{handler:function(t){console.log(JSON.stringify(t)),console.log(JSON.stringify(this.currentFormData)),JSON.stringify(t)===JSON.stringify(this.currentFormData)?this.okSta=!0:this.okSta=!1},deep:!0},isAdd:function(){this.updateData()},code:function(){this.updateData()},isStation:function(){this.updateData()},idDisable:function(){this.updateData()}},methods:{tableDbEdit:function(t,e,a,i){console.log(JSON.stringify(t)),console.log(JSON.stringify(e)),console.log(JSON.stringify(a)),this.formDisable||a.cellIndex<=0||console.log(a,i)},editClick:function(t){this.formDisable=!1,t()},cancelClick:function(t){this.formDisable=!0,this.data=JSON.parse(JSON.stringify(this.currentFormData)),t()},okClick:function(t){var e=this;if(this.isAdd){var a=this.addLineOk();a&&t()}else this.$httpApi.updateInfo(this.code,e.data).then((function(a){e.okSta=!0,"0"==a.data.code?(e.currentFormData=JSON.parse(JSON.stringify(e.data)),e.formDisable=!0,t(),e.$emit("change",e.data.id,e.data.name)):e.data=JSON.parse(JSON.stringify(e.currentFormData))})).catch((function(){}))},addLineOk:function(){var t=this;return console.log("添加线路"),this.$httpApi.addLine(t.data).then((function(e){if("0"==e.data.code)return t.okSta=!0,t.currentFormData=JSON.parse(JSON.stringify(t.data)),t.formDisable=!0,t.$emit("add",t.data.id,t.data.name),!0;m["Message"].error(e.data.message)})),!1},initAddLine:function(){this.btnIsAdd=!0,this.title="增加线路信息(编码格式：Lxxx)",this.formDisable=!1,this.idDisable=!1,this.data={id:"L",name:"",enName:"",subLineNum:"1",dataServer:"",cmdServer:""},this.currentFormData=JSON.parse(JSON.stringify(this.data)),this.tableData=[],console.log("添加")},updateData:function(){if(console.log("获取线路信息"+this.code),this.isAdd)this.initAddLine();else{this.btnIsAdd=!1,this.title="线路信息",this.idDisable=!0;var t=this;this.$httpApi.lineInfo(this.code).then((function(e){"0"==e.data.code&&(console.log(JSON.stringify(e.data)),t.currentFormData=JSON.parse(JSON.stringify(e.data.info)),t.data=e.data.info,t.tableData=e.data.devList)}))}}},mounted:function(){this.updateData()}},F=E,I=(a("748a"),Object(d["a"])(F,L,T,!1,null,null,null)),B=I.exports,V={components:{allLineVue:u,stationinfoVue:x,lineInfoVue:B},data:function(){return{node:null,treeData:[],props:{label:"name",children:"children",isLeaf:"leaf",id:"id",type:"type",parentId:"parentId"},menuVisible:!1,showAddLine:!1,showAddStation:!1,showDeleteLine:!1,showDeleteStation:!1,showDeleteTrain:!1,showAddTrain:!1,currentData:null,currentNode:null,sideShow_allLine:!1,sideShow_line:!1,sideShow_station:!1,trsfData:"",trsfType:!0,isAdd:!1,dialog:{visible:!1,tipMsg:"",isLine:!1,id:""}}},methods:{changeStationName:function(t,e){this.trsfData.name=t+"  "+e},changeLineName:function(t,e){console.log(t+"  "+e),this.trsfData.name=t+"  "+e},loadNode:function(t,e){return 0===t.level?(this.node=t,e([{name:"OCC及车站",type:1,id:"parentID"}])):t.level>=1?(console.log(JSON.stringify(t.data)),this.$httpApi.lineList(t.data.id).then((function(t){if("0"==t.data.code)return console.log(JSON.stringify(t.data.dataList)),e(t.data.dataList)})),e([])):void 0},rightClick:function(t,e,a){this.menuVisible=!1,this.currentData=e,this.$refs.tree.setCurrentKey(e.id),this.currentNode=a,console.log("right click level=",a.level,JSON.stringify(e)),this.showDeleteLine=this.showAddTrain=this.showAddStation=1!=a.level&&3==e.type,this.showDeleteStation=1!=a.level&&4==e.type,this.showDeleteTrain=1!=a.level&&5==e.type,this.showAddLine=1==a.level||e.type<4,this.menuVisible=!0,document.addEventListener("click",this.foo);var i=document.querySelector("#menu");i.style.left=t.clientX-150+"px",i.style.top=t.clientY-60+"px",this.clickFunc(e,a,null)},foo:function(){this.menuVisible=!1,document.removeEventListener("click",this.foo)},clickFunc:function(t){console.log("获取信息："+JSON.stringify(t)),this.sideShow_allLine=1==t.type,this.sideShow_line=3==t.type,this.sideShow_station=2==t.type||4==t.type||5==t.type,this.trsfData=t,this.trsfType=5!=t.type,this.isAdd=!1},addLine:function(){this.isAdd=!0,this.sideShow_allLine=this.sideShow_station=!1,this.sideShow_line=!0,this.trsfData=this.currentData,this.trsfType=!1},addStaAction:function(t,e,a){console.log("添加完成站点",t,e);var i={id:t,type:a?5:4,name:t+" "+e,leaf:!0},n=this.$refs.tree.getCurrentNode(),s=this.$refs.tree.getNode(n);s.isLeaf?(s.loaded=!1,s.expand(),console.log("调用expand")):(this.$refs.tree.append(i,n),console.log("直接增加")),this.$refs.tree.setCurrentKey(t);var o=this.$refs.tree.getNode(i);this.clickFunc(i,o,null)},addLinAction:function(t,e){console.log(t,e);var a={id:t,type:3,name:t+" "+e,leaf:!0};this.$refs.tree.append(a,this.node.childNodes[0]),this.$refs.tree.setCurrentKey(t);var i=this.$refs.tree.getNode(a);this.clickFunc(a,i,null)},dialogOkClick:function(){var t=this,e=t.$refs.tree.getCurrentNode();console.log("删除"+e.id),this.dialog.isLine?this.$httpApi.deleteLine(e.id).then((function(a){"0"==a.data.code?e&&t.$refs.tree.remove(e):m["Message"].error(a.data.message)})):this.$httpApi.deleteSta(e.id).then((function(a){"0"==a.data.code?e&&t.$refs.tree.remove(e):m["Message"].error(a.data.message)})),this.dialog.visible=!1},deleteLinAction:function(){var t=this,e=t.$refs.tree.getCurrentNode();this.dialog.tipMsg="是否删除"+e.id+"?",this.dialog.isLine=!0,this.dialog.visible=!0},deleteStation:function(){var t=this,e=t.$refs.tree.getCurrentNode();this.dialog.tipMsg="是否删除"+e.id+"?",this.dialog.isLine=!1,this.dialog.visible=!0},addStation:function(t){this.isAdd=!0,this.sideShow_allLine=!1,this.sideShow_station=!0,this.sideShow_line=!1,this.trsfData=this.currentData,this.trsfType=t,console.log(this.trsfData,this.trsfType)}},mounted:function(){var t=this.node.childNodes[0];t.expanded=!0,t.loadData()}},z=V,M=(a("1b92"),Object(d["a"])(z,i,n,!1,null,null,null));e["default"]=M.exports},bada:function(t,e,a){},d32e:function(t,e,a){"use strict";a("bada")},e2f8:function(t,e,a){},f20b:function(t,e,a){},f78b:function(t,e,a){}}]);
//# sourceMappingURL=chunk-e4314f36.c1597373.js.map